let app = getApp();
let img = wx.getStorageSync("img");

Page({
    data: {
        title: '品牌',
        lists: [{
                alphabet: 'A',
                datas: [{
                    name: "风一样男子",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg",
                    model: [{
                        modelid: 12,
                        modelname: '每回',
                        image: 'img_1'
                    }, {
                        modelid: 13,
                        modelname: '每每',
                        image: 'img_2'
                    }]
                }, {
                    name: "风一样de",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }],
            },
            {
                alphabet: 'B',
                datas: [{
                    name: "风一样",
                    avater: "http://img.zcool.cn/community/01b4fa55de8e0532f875a132d6f99c.jpg@1280w_1l_2o_100sh.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'C',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'D',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'E',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'F',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'G',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'H',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'I',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'J',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'K',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'L',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'M',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'N',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'O',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'P',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'Q',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'R',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'S',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'T',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'U',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'V',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'W',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'X',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'Y',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
            {
                alphabet: 'Z',
                datas: [{
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201211/2012111719294197.jpg"
                }, {
                    name: "风一样",
                    avater: "http://www.pptbz.com/pptpic/UploadFiles_6909/201203/2012031220134655.jpg"
                }, {
                    name: "风一样",
                    avater: "http://pic18.nipic.com/20120203/8215229_164952068393_2.jpg"
                }]
            },
        ],
        arr: '',
        userdata: null,
        list: [],
    },
    onShow() {
        let userdata = wx.getStorageSync('userdata');
        if (userdata) {
            this.setData({
                userdata: userdata,
            });
            this.getdata();
        }
    },
    //获取车型列表库
    getdata() {
        wx.showLoading({
            title: '加载中',
        })
        let that = this,
            url = '/MobileInternet/index/update_car_json',
            params = {};
        app.request.getdata(2, url, params, (res => {
            let my = res.data;
            if (my.status) {
                let url = my.data.url.split('http');
                wx.request({
                    url: "https" + url[1],
                    success(res) {
                        if (res.statusCode == 200) {
                            let thelist = that.the_filter(res.data.list),
                                hotlist = that.the_file(res.data.hot_list),
                                alllist = hotlist.concat(thelist);
                            that.setData({
                                list: alllist
                            })
                            setTimeout(() => {
                                wx.hideLoading();
                            }, 3000);
                            // console.log(alllist);
                        }
                    }
                })
            }
        }))
    },
    //过滤车型 热度车型
    the_file(val) {
        let oldDataRule = [];
        val.forEach(e => {
            let all = {
                alphabet: '热',
                datas: [],
            };
            let all_brand = {
                brandid: e.brandid,
                avater: e.logo,
                name: e.brandname,
                model: e.model
            };
            all.datas.push(all_brand);
            oldDataRule.push(all);
        });
        let only = [];
        let hot_arr = [{
            alphabet: '热',
            datas: only
        }];
        for (let i in oldDataRule) {
            oldDataRule[i].datas.forEach(el => {
                only.push(el);
            })
        };
        return hot_arr;
    },
    //过滤车型接口的数据（普通 不包括 热）
    the_filter(val) {
        // 把源数据先变成目标数据的规则
        let oldDataRule = [];
        val.forEach(e => {
            let all = {
                alphabet: e.tagname,
                datas: [],
            };
            let all_brand = {
                brandid: e.brandid,
                avater: e.logo,
                name: e.brandname,
                model: e.model
            };
            all.datas.push(all_brand);
            oldDataRule.push(all);
        });
        /**
         * 先去重，后合并
         * 1、源数据去重
         * 2、把去重后的数据和源数据中相同name的数据合并citys
         */
        let newData = [];
        let newObj = {};
        oldDataRule.forEach((el, i) => {
            if (!newObj[el.alphabet]) {
                newData.push(el);
                newObj[el.alphabet] = true;
            } else {
                newData.forEach(el => {
                    if (el.alphabet === oldDataRule[i].alphabet) {
                        el.datas = el.datas.concat(oldDataRule[i].datas);
                    }
                })
            }
        })
        return newData;
    }
})